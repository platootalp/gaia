以下是基于 **ICIO（Instruction、Context、Input Data、Output Indicator）** 框架，为“大模型应用领域设计专家”设计的提示词模板。目标是让
AI 专家使用 **DDD（领域驱动设计）** 方法，对一个类似 Dify、Coze、阿里云百炼的大模型应用平台进行完整的领域分析与设计，输出每一步的设计思路与结果，涵盖：

* 领域探索
* 子域识别
* 上下文映射
* 领域建模（聚合、服务、值对象）
* 应用服务编排
* 基础设施实现
* 上下文通信与防腐层设计

---

## 🔶 提示词模板（Prompt Template）— ICIO 格式

---

### 🟧 Instruction（指令）

你是一位资深的大模型应用架构设计专家，擅长使用领域驱动设计（DDD）方法对复杂软件系统进行分析与建模。现在需要你作为专家，使用
DDD 方法，从0到1设计一个大模型应用平台，该平台类似于 Dify、Coze、阿里云百炼，支持用户创建、配置、发布大模型应用。

请按照领域驱动设计的关键阶段，逐步输出每一步的分析思路和设计成果，包括但不限于以下步骤：

1. 领域探索（Domain Exploration）
2. 子域识别（Subdomain Identification）
3. 上下文映射（Context Mapping）
4. 领域建模（聚合、实体、值对象、领域服务）
5. 应用服务编排
6. 基础设施设计（适配器、网关、数据库、模型服务集成）
7. 上下文之间的通信机制与防腐层设计

每个步骤请依次输出，保持结构化表达，突出设计决策依据。

---

### 🟦 Context（背景）

你所设计的平台是一个 **面向企业客户和开发者的 LLM 应用构建平台**，它具备如下特征：

* 用户可创建“智能体”（Agent），定义其角色、提示词、插件能力；
* 支持基于 RAG 的知识库增强；
* 可配置 API 接口，供第三方调用；
* 提供可视化的应用流程编排（如节点式流程图）；
* 多租户 + 权限模型 + 审计日志；
* 后端以微服务或模块化架构为基础，要求便于扩展和维护；
* 用户规模预期中大型（SaaS 或私有部署）；
* 需兼容多种大模型服务商（OpenAI、阿里、讯飞等）；
* 业务变化快，强调领域的高度内聚与松耦合。

---

### 🟩 Input Data（输入数据）

* 平台主要能力列表（初始需求文档）
* 同类竞品特征（如 Dify、Coze、百炼）
* 企业用户画像（对稳定性、安全性、可运维性要求高）
* 团队开发能力（具备中高级 Java + Spring + 分布式开发经验）

---

### 🟨 Output Indicator（输出指标）

你输出的结果需满足以下标准：

* 每一个阶段需明确 **目标、过程、产出物**
* 使用专业的 DDD 术语（如限界上下文、聚合根、值对象等）
* 每个子域的职责边界清晰，具备可实现性
* 输出结构分层合理，有助于团队落地开发
* 使用表格 / 分点 / 分层次清晰表达信息
* 如果可视化结构（如上下文图、模型图）有助于理解，也请输出为描述

---

## ✅ 示例调用方式

你可以直接将以下内容复制到对话中进行调用：

```
你是一位大模型应用领域设计专家，使用 DDD 方法，从 0 到 1 分析并设计一个 LLM 应用平台（类似于 Dify、Coze、百炼），请按照如下步骤逐一输出设计结果：

1. 领域探索（明确核心用户目标、关键业务流程）
2. 子域识别（区分核心域、支撑域、通用域）
3. 上下文映射（限界上下文划分 + 上下文关系）
4. 领域建模（包括实体、聚合、服务、值对象建模）
5. 应用服务编排（协调多个聚合，实现业务用例）
6. 基础设施设计（数据库、API 网关、大模型服务集成等）
7. 上下文通信与防腐层设计（如反腐适配器、防腐桥）

请使用结构化输出（分点说明 + 表格展示 + 简图描述），每一部分都要说明设计思路与原因。
```

## 提示词模板

### 生成详细文档

```
{{text}}      
 这是{{topic}}的文档概述，现在我需要你把每一章都详细说明一下，一个章节一个章节的来，说明完一章后停止，请求我的输入
```

### 给出详细文档目录

```
{{text}}
给出文档目录，并按照标准论文章节标题格式来规范每一章节的标题
```

### 修改详细文档章节标题

```
{{text}}
请按照以下要求目录修改文档章节标题：
{{directory}}
```

{{# **分布式限流概述**

## **一、引言**

1. 背景与意义

    * 为什么需要限流
    * 分布式环境下的限流挑战
2. 典型应用场景

    * 接口限流（API Gateway）
    * 微服务调用限流
    * 用户/租户级限流
    * 第三方服务保护
3. 系统目标与设计原则

    * 高可用、低延迟
    * 精准与一致性
    * 可扩展与动态配置

---

## **二、限流的基本原理**

1. 限流的定义
2. 限流与降级、熔断的关系
3. 限流维度划分

    * 全局限流
    * 服务限流
    * 接口限流
    * 用户/租户限流
4. 限流指标与单位

    * QPS（请求数/秒）
    * 并发数
    * 时间窗口

---

## **三、常见限流算法概述**

1. 固定窗口算法（Fixed Window）

    * 算法原理
    * 优缺点分析
    * 适用场景
2. 滑动窗口算法（Sliding Window）

    * 时间片滑动原理
    * 精度与内存权衡
    * 实现示例
3. 漏桶算法（Leaky Bucket）

    * 算法逻辑与流控模型
    * 平滑流量特性
    * 应用案例
4. 令牌桶算法（Token Bucket）

    * 核心思想
    * 令牌生成与消费逻辑
    * 动态令牌速率调节
5. 组合算法与改进方案

    * 滑动窗口 + 令牌桶
    * 基于优先级队列的限流
    * 自适应限流（Adaptive Rate Limiting）

---

## **四、分布式限流的实现方式**

1. 单节点限流 vs 分布式限流
2. 分布式限流核心问题

    * 时钟同步问题
    * 一致性与原子性
    * 状态共享与同步延迟
3. 分布式限流架构模型

    * 集中式（基于中控节点）
    * 去中心化（多节点协同）
    * 混合式架构
4. 状态存储层选型

    * Redis 实现（原子操作 + Lua 脚本）
    * Etcd/Zookeeper 实现（强一致性）
    * 基于数据库/MySQL 的限流方案（不推荐但可兜底）

---

## **五、基于 Redis 的分布式限流算法实现**

1. Redis + Lua 的原子性实现
2. Redis Key 设计规范
3. 典型算法实现示例

    * 固定窗口实现
    * 滑动窗口实现
    * 令牌桶实现
4. 性能与可靠性优化

    * Pipeline / Cluster 支持
    * 热点 Key 分片策略
    * 异步削峰与延迟放行

---

## **六、高级限流设计**

1. 多维度限流（用户 + 接口 + 租户）
2. 动态配置与限流规则下发
3. 集群一致性方案

    * Gossip / Raft / Redis Stream 协调
4. 自适应限流（Adaptive / AI-based Rate Limiting）

    * 指标监控反馈调节
    * 机器学习预测流量趋势

---

## **七、分布式限流系统设计案例**

1. Spring Cloud Gateway 限流方案
    * 使用 RedisRateLimiter
    * 自定义 KeyResolver 与 Filter
2. Sentinel / Resilience4j 分布式限流机制

    * 规则模型与集群流控模式
3. 企业级分布式限流平台架构设计

    * 控制台管理
    * 规则同步
    * 实时监控与动态调整

---

## **八、性能与稳定性考量**

1. 延迟与一致性权衡
2. 限流系统的高可用部署
3. 异常与容错机制

    * Redis 故障回退策略
    * 客户端缓存与本地兜底限流
4. 性能测试与容量评估

---

## **九、安全与审计**

1. 规则变更的权限控制
2. 限流策略审计与追踪
3. 防攻击设计（绕过限流、刷接口等）

---

## **十、总结与展望**

1. 分布式限流的演进方向

    * 从静态规则到动态决策
    * 从规则驱动到智能预测
2. 限流与弹性架构结合趋势
3. 未来方向：AI 调节限流、基于流量画像的智能流控


}}      
这是{{分布式限流}}的文档目录，现在我需要你把每一章都详细说明一下，一个章节一个章节的来，说明完一章后停止，请求我的输入