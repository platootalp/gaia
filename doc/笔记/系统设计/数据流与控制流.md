这是一个非常经典且重要的架构概念区分问题。我们来清晰地解释 **数据流（Data Flow）** 与 **控制流（Control Flow）**，并结合你的场景（向
DB 记录上传的文件信息）给出明确归类。

---

### 一、基本定义

| 概念                    | 定义                      | 关键特征                                                      |
|-----------------------|-------------------------|-----------------------------------------------------------|
| **数据流（Data Flow）**    | 系统中**业务数据**的移动、存储、转换过程  | - 承载用户/业务核心内容<br>- 通常体量大、需持久化<br>- 如：上传的文件内容、用户头像、交易记录    |
| **控制流（Control Flow）** | 系统中**协调、调度、状态管理**的信号或指令 | - 用于驱动流程、决策、同步<br>- 通常体量小、语义强<br>- 如：API 调用、状态变更通知、任务触发指令 |

> 💡 简单类比：
> - **数据流 = 货物**（要运输的东西）
> - **控制流 = 调度指令 + 路单**（告诉货物怎么运、何时运、运到哪）

---

### 二、你的场景分析：**“向 DB 记录上传的文件信息”**

这里的“文件信息”通常指：

- 文件 ID、文件名、大小、存储路径（如 S3 key）
- 上传者、上传时间、状态（上传中/成功/失败）
- 元数据（如 content-type、分片信息）

这些**不是文件本身的内容**，而是**描述文件的元数据（metadata）**。

#### 那它属于数据流还是控制流？

✅ **答案：属于控制流**（更准确地说，是**控制流的持久化记录**）

#### 为什么？

1. **目的不是承载业务内容**，而是**管理上传任务的状态与上下文**；
2. 它用于：
    - 后续查询“这个文件是否上传成功？”
    - 异步任务调度（如“发现状态为‘待处理’，启动转码”）
    - 幂等性控制（“同一个文件 ID 已存在，不再重复处理”）
3. 这些都是**系统协调与治理行为**，而非用户关心的“文件内容”。

> 📌 类比：快递单号 ≠ 快递包裹。  
> 文件内容 = 包裹（**数据流**）  
> DB 中的记录 = 快递单 + 状态（**控制流**）

---

### 三、边界情况说明

| 场景                       | 归类      | 说明            |
|--------------------------|---------|---------------|
| 用户上传的 PDF 文件本身           | **数据流** | 业务核心内容        |
| DB 中记录该 PDF 的存储路径、大小、上传者 | **控制流** | 用于系统管理        |
| DB 中存储 PDF 的全文文本（用于搜索）   | **数据流** | 此时元数据已转化为业务数据 |
| 上传成功后发消息给 MQ 触发转码        | **控制流** | 调度指令          |

> ⚠️ 注意：**元数据是否属于数据流，取决于它的用途**。  
> 如果元数据本身是业务功能的一部分（如“用户可搜索文件标签”），那它就**兼具数据流属性**。  
> 但在**上传流程的上下文中**，它主要是控制流。

---

### 四、在架构图中如何表示？

- **数据流**：用**实线 + 数据图标**（如文件、数据库图标），可标注数据内容（如 “file bytes”）
- **控制流**：用**虚线 / 带箭头的细线**，标注动作或状态（如 “create upload record”, “trigger async job”）

例如：

```
[Client] --(file bytes)--> [File Storage]     ← 数据流
[Client] --(create record)--> [Upload Service] --> [DB]  ← 控制流
```

---

### 五、结合你的关注点

你之前提到：

- 关注异步任务状态管理
- 关注上传服务内部模块（数据源管理、文件处理）
- 关注可观测性与可靠性

那么，**DB 中的上传记录正是控制流的核心载体**：

- 它是**状态机的持久化状态**
- 是**可观测性的数据来源**（查 DB 知道任务卡在哪）
- 是**异步链路可靠性的基础**（靠它实现重试、幂等）

因此，在架构图中，这条路径应明确标记为**控制流**，并可强调其可靠性设计（如“事务写入”、“状态最终一致”等）。

---

### ✅ 总结

> **向 DB 记录上传的文件信息（元数据）属于控制流**，  
> 因为它用于**协调、跟踪、治理上传过程**，而非传输用户业务数据本身。

