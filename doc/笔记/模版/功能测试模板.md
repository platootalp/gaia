# 文件上传网关功能验证测试文档

## 一、概述

### 1.1 目的

本文档用于验证文件上传网关的核心功能是否正常运行，包括文件上传、格式校验、大小限制、上传进度、错误处理、安全策略等关键功能点。

### 1.2 范围

- 支持的文件类型上传
- 文件大小限制控制
- 上传接口可用性
- 上传过程中的异常处理
- 安全性验证（如防恶意文件上传）
- 上传成功后的响应与元数据返回

### 1.3 测试环境

| 项目    | 配置                                                 |
|-------|----------------------------------------------------|
| 服务地址  | `https://upload-gateway.example.com/api/v1/upload` |
| 认证方式  | Bearer Token / API Key                             |
| 支持协议  | HTTPS                                              |
| 测试客户端 | Postman / cURL / 自定义测试脚本                           |
| 网关版本  | v2.3.1                                             |

---

## 二、测试目标

| 功能模块    | 验证目标                           |
|---------|--------------------------------|
| 基础上传功能  | 验证正常文件能否成功上传并返回正确响应            |
| 文件类型校验  | 验证仅允许上传白名单内的文件类型               |
| 文件大小限制  | 验证超限文件被拒绝并返回合理错误码              |
| 多文件上传   | 验证批量上传功能是否支持                   |
| 上传进度与分片 | （如支持）验证大文件分片上传与进度跟踪            |
| 错误处理    | 验证各种异常情况下的错误响应是否合理             |
| 安全性     | 验证防病毒扫描、防恶意文件注入等机制             |
| 元数据返回   | 验证上传成功后返回的文件信息（ID、URL、大小等）是否正确 |

---

## 三、测试用例

### 3.1 正常上传测试

| **测试目标** | 验证常见文件（如 `.jpg`, `.pdf`）能否正常上传。                                                                                    |
|----------|--------------------------------------------------------------------------------------------------------------------|
| **前置条件** | 用户已认证，服务正常运行。                                                                                                      |
| **测试步骤** | 1. 使用 `POST /upload` 接口上传一个 1MB 的 `.jpg` 文件。<br>2. 携带有效的 `Authorization` 头。<br>3. 使用 `multipart/form-data` 格式提交文件。 |
| **预期结果** | - HTTP 状态码：`200 OK`<br>- 响应体包含：`fileId`, `fileName`, `fileUrl`, `size`, `uploadTime`<br>- 文件可在指定 URL 下载。           |
| **实际结果** | \[填写]                                                                                                              |
| **测试状态** | 通过 / 失败 / 待测                                                                                                       |

---

### 3.2 文件类型校验测试

| **测试目标** | 验证仅允许上传白名单内的文件类型（如 `.jpg`, `.pdf`）。                                                                          |
|----------|--------------------------------------------------------------------------------------------------------------|
| **前置条件** | 用户已认证，服务正常运行。                                                                                                |
| **测试步骤** | 1. 使用 `POST /upload` 接口上传一个 `.exe` 文件。<br>2. 携带有效的 `Authorization` 头。<br>3. 使用 `multipart/form-data` 格式提交文件。 |
| **预期结果** | - HTTP 状态码：`415 Unsupported Media Type`<br>- 响应体包含：错误提示信息，说明文件类型不被支持。                                        |
| **实际结果** | \[填写]                                                                                                        |
| **测试状态** | 通过 / 失败 / 待测                                                                                                 |

---

### 3.3 文件大小限制测试

| **测试目标** | 验证超限文件是否被拒绝并返回合理的错误码（如 413 Payload Too Large）。                                                                      |
|----------|---------------------------------------------------------------------------------------------------------------------|
| **前置条件** | 用户已认证，服务正常运行。                                                                                                       |
| **测试步骤** | 1. 使用 `POST /upload` 接口上传一个超过最大限制（如 10MB）的文件。<br>2. 携带有效的 `Authorization` 头。<br>3. 使用 `multipart/form-data` 格式提交文件。 |
| **预期结果** | - HTTP 状态码：`413 Payload Too Large`<br>- 响应体包含：错误提示信息，说明文件超出大小限制。                                                    |
| **实际结果** | \[填写]                                                                                                               |
| **测试状态** | 通过 / 失败 / 待测                                                                                                        |

---

### 3.4 流量控制测试

| **测试目标** | 验证限流配置是否正常工作，确保不会因上传请求过多而导致系统性能问题。                                     |
|----------|------------------------------------------------------------------------|
| **前置条件** | 用户已认证，服务正常运行，系统启用流量控制。                                                 |
| **测试步骤** | 1. 同时发起多个并发上传请求（如 10 个请求同时上传相同文件）。<br>2. 每个请求上传一个 1MB 的文件。             |
| **预期结果** | - HTTP 状态码：`200 OK`<br>- 所有上传请求均正常完成，文件上传成功。<br>- 系统能够限制过多并发上传导致的性能问题。 |
| **实际结果** | \[填写]                                                                  |
| **测试状态** | 通过 / 失败 / 待测                                                           |

---

### 3.5 上传路径控制测试

| **测试目标** | 验证上传文件是否受到路径控制的限制，确保只允许上传至指定路径。                                                                        |
|----------|--------------------------------------------------------------------------------------------------------|
| **前置条件** | 用户已认证，服务正常运行。                                                                                          |
| **测试步骤** | 1. 使用 `POST /upload` 接口上传一个 1MB 的文件，路径设置为禁止上传的路径（如 `/restricted/path`）。<br>2. 携带有效的 `Authorization` 头。 |
| **预期结果** | - HTTP 状态码：`403 Forbidden`<br>- 响应体包含：错误提示信息，说明上传路径不允许。                                                |
| **实际结果** | \[填写]                                                                                                  |
| **测试状态** | 通过 / 失败 / 待测                                                                                           |

---

### 3.6 安全性验证测试

| **测试目标** | 验证上传过程中是否严格执行认证与授权，确保只有经过认证的用户可以上传文件。                     |
|----------|-----------------------------------------------------------|
| **前置条件** | 用户未认证，服务正常运行。                                             |
| **测试步骤** | 1. 使用 `POST /upload` 接口上传一个文件，但不携带认证信息（如 JWT）。            |
| **预期结果** | - HTTP 状态码：`401 Unauthorized`<br>- 响应体包含：错误提示信息，说明上传需要认证。 |
| **实际结果** | \[填写]                                                     |
| **测试状态** | 通过 / 失败 / 待测                                              |

---

### 3.7 异常处理测试

| **测试目标** | 验证上传过程中出现异常时的错误处理能力，确保系统返回合理的错误信息并不会崩溃。                                   |
|----------|---------------------------------------------------------------------------|
| **前置条件** | 用户已认证，服务正常运行。                                                             |
| **测试步骤** | 1. 模拟上传过程中断（如关闭网络连接）。<br>2. 上传一个 1MB 的文件。                                 |
| **预期结果** | - HTTP 状态码：`500 Internal Server Error`<br>- 响应体包含：错误提示信息，说明文件上传失败并提供恢复建议。 |
| **实际结果** | \[填写]                                                                     |
| **测试状态** | 通过 / 失败 / 待测                                                              |

## 四、性能与稳定性测试（可选）

| 测试项    | 描述                            |
|--------|-------------------------------|
| 并发上传   | 同时发起 50 个上传请求，观察成功率与响应时间      |
| 大文件上传  | 上传 99MB 的 `.mp4` 文件，验证是否支持并成功 |
| 上传中断恢复 | （如支持分片）验证断点续传功能               |

---

## 五、测试结论

| 项目      | 结果                  |
|---------|---------------------|
| 功能完整性   | ✅ / ❌               |
| 安全性     | ✅ / ❌               |
| 错误处理合理性 | ✅ / ❌               |
| 性能表现    | 良好 / 一般 / 需优化       |
| 总体评估    | [通过 / 不通过 / 需修复后复测] |

---

## 六、问题记录

| 问题编号    | 问题描述                     | 严重等级 | 处理状态 | 负责人 |
|---------|--------------------------|------|------|-----|
| BUG-001 | 上传 `.svg` 文件未被拦截（应为危险类型） | 高    | 待修复  | 张三  |
| BUG-002 | 多文件上传时部分文件未返回 URL        | 中    | 已反馈  | 李四  |

---

## 七、附件

- [x] 测试脚本（Python/Shell）
- [x] Postman 测试集合导出
- [x] 成功/失败响应截图

---

## 八、审批

| 角色    | 姓名   | 签字 | 日期 |
|-------|------|----|----|
| 测试负责人 | [姓名] |    |    |
| 开发负责人 | [姓名] |    |    |
| 运维负责人 | [姓名] |    |    |

