你是一名资深 Java SDK 设计专家，精通 Spring Boot、OkHttp、GuavafastJson、Lombok 等主流生态，在 SDK
设计上具有丰富经验，擅长设计高内聚、低耦合、可扩展的 SDK 组件，严格遵循阿里 Java 开发规范与 Clean Code 原则。
现在，请你基于以下我提供的详细输入，输出一份完整、可落地的 SDK 设计方案。
---

## **【第一部分：需求与上下文输入】**

* **1. 需求目标**
    * **核心价值**：让 Java 应用能以极低的成本、高可靠性和高性能的方式，将文件安全地上传到我们的云存储服务。
    * **业务场景**：云存储、内容分发（CDN）、媒体处理、数据备份。
* **2. 使用场景与调用方**
    * **调用方类型**：后端微服务（处理用户头像、文档等）、大数据任务（上传日志、数据报告）、第三方合作伙伴（通过集成我们的服务上传内容）。
    * **运行环境**：主要运行在 Spring Boot 应用中，也需要兼容纯 Java 应用和 Serverless 环境（如 AWS Lambda）。
    * **并发量级预估**：中到高频（50-500 QPS），并伴有突发流量。
* **3. 功能要求**
    * **核心功能列表**：
        * 功能点 1：简单文件上传
            * 对应 API 端点：`/api/v1/files`
            * 请求方式：`POST` (Content-Type: multipart/form-data)
            * 关键请求参数：`file` (文件流), `path` (存储路径), `metadata` (可选的JSON字符串元数据)
            * 关键响应数据：`fileId`, `url`
        * 功能点 2：分块上传
            * 对应 API 端点：
                - 初始化：`POST /api/v1/multipart/init`
                - 上传分块：`PUT /api/v1/multipart/{uploadId}/{partNumber}`
                - 完成上传：`POST /api/v1/multipart/complete`
            * 请求方式：`POST`, `PUT`, `POST`
            * 关键请求参数：
                - 初始化：`fileName`, `totalSize`, `partSize`
                - 上传分块：分块二进制数据
                - 完成上传：`uploadId`, `partETags` (分块号和ETag的列表)
            * 关键响应数据：
                - 初始化：`uploadId`
                - 上传分块：`etag`
                - 完成上传：`fileId`, `url`
        * 功能点 3：获取上传进度
            * 对应 API 端点：SDK 内部状态管理，非直接 API 调用。
            * 请求方式：N/A
            * 关键请求参数：N/A
            * 关键响应数据：通过回调或 `CompletableFuture` 返回进度百分比。
    * **认证方式**：API Key + Secret，使用签名算法（如 HMAC-SHA256）对请求进行签名。
* **4. 非功能要求**
    * **性能**：小文件（< 5MB）平均上传延迟 < 200ms，P99 延迟 < 1s。大文件上传需提供稳定的吞吐量。
    * **依赖管理**：核心依赖为 OkHttp 4.12.0、Jackson、Lombok。避免引入 Feign、Spring Web MVC 等重型依赖。
    * **线程安全**：[是] 必须保证 Client 实例的线程安全，可在多线程环境中共享。
    * **异步调用**：[是] 需要支持异步调用，偏好使用 `CompletableFuture`，尤其对于分块上传。
    * **配置注入**：[是] 需要支持与 Spring Boot 的 `@ConfigurationProperties` 集成。
    * **可扩展性**：[是] 需要具备可扩展的 SPI 机制，用于自定义签名算法、进度监听器等。
    * **异常体系**：[是] 需要提供详细的异常定义和错误码体系，区分网络错误、认证错误、服务端错误等。
    * **日志与回调**：[是] 需要提供完善的日志（支持不同日志框架）与上传进度回调机制。
    * **可测试性**：[是] 必须支持 Mock 与单元测试，特别是对网络请求的 Mock。
    * **重试机制**：[是] 需要支持可配置的重试策略（如：仅对网络异常和 5xx 错误重试，支持指数退避），并保证分块上传的幂等性。
    * **熔断降级**：[是] 需要集成熔断降级能力。
* **5. 其他约束**
    * **目标 Java 版本**：Java 8
    * **服务端 API 规范**：RESTful
    * **序列化协议**：JSON (用于元数据), Multipart (用于文件体)
    * **已有技术栈**：当前底层采用 Feign，期望重构为 OkHttp 4.12.0。

---

## **【第二部分：设计方案输出】**

1️⃣ **架构设计概述**
...
2️⃣ **核心类设计**
...
3️⃣ **调用示例代码**
...
4️⃣ **错误处理与重试机制设计**
...
5️⃣ **最佳实践与扩展点**
...
6️⃣ **单元测试与Mock建议**
...
7️⃣ **文档与发布建议**
...
---

## **【最终指令】**

在设计时，请始终牢记 DDD 思想的“领域模型清晰、接口职责单一”原则，优先考虑企业级 SDK 的长期可维护性和平滑演进性。输出内容应包含清晰、可读的
Java 代码片段和结构化的文档。请基于以上输入，输出一份完整的、可落地的文件上传 SDK 设计方案。
