## 💡 Cursor 提示词模板 — 实现 `tos-core/core/upload` 三步上传（高内聚可扩展版）

```text
你现在是资深 Java SDK 架构师，请在 `tos-core/core/upload` 模块内实现 “三步上传” 的核心能力。  
实现目标不是简单上传文件，而是抽象出一个可扩展、可复用的上传框架，方便未来支持分片上传、流式上传等高级场景。

---

### 🧩 项目上下文

当前 SDK 项目结构如下（重要部分）：

tos-sdk/
 └── tos-core/
     ├── src/main/java/com/tuhu/tos/
     │   ├── api/                 # SDK入口类 TosClient
     │   ├── core/upload/         # 目标实现位置
     │   ├── transport/           # 已封装的 HTTP 传输层（OkHttp）
     │   └── model/upload/        # 上传请求、响应模型定义

在本任务中，你需要在 `tos-core/core/upload` 下，利用已有的 `transport` 模块实现一个**标准的三步上传策略类**，遵循高内聚、低耦合、可扩展的设计。

---

### ⚙️ 设计目标

**功能目标**
1. **第一步**：向服务端请求上传授权信息（如表单参数、上传URL等）。
2. **第二步**：使用授权信息将文件上传到云存储（COS/OBS/OSS等）。
3. **第三步**：通知服务端上传完成，触发云上后处理。

**设计目标**
- 面向接口编程，不面向具体业务。
- 通过 **模板方法模式 + 策略模式** 实现三步上传流程骨架。
- 每个阶段可独立扩展或替换实现。
- 使用已有的 `TransportClient` 发起 HTTP 请求。
- 保持 SDK 层与业务层解耦。

---

### 🧠 架构设计建议

**包结构（建议）**

tos-core/core/upload/
├── UploadContext.java # 上传上下文，存放文件、凭证、配置等信息
├── UploadExecutor.java # 上传执行器（模板方法模式）
├── UploadStep.java # 三步上传抽象接口
├── impl/
│ ├── AuthStep.java # 第一步：获取授权
│ ├── CloudUploadStep.java # 第二步：上传到云
│ ├── ReportStep.java # 第三步：上报处理结果
│ └── DefaultThreeStepUploader.java # 默认三步上传策略实现
└── strategy/
├── UploadStrategy.java # 策略接口（已存在）
└── ThreeStepUploadStrategy.java # 三步上传实现类（扩展完善）

---

### 🧩 模式设计说明

- **模板方法模式（Template Method）**  
  抽象出上传的标准流程：`authorize → upload → report`，由子类实现各步骤细节。

- **策略模式（Strategy Pattern）**  
  允许注册不同上传策略（如 Default、Stream、Multipart），便于未来扩展。

- **工厂模式（Factory Pattern）**  
  由 `TosClient` 或 `UploadStrategyFactory` 选择不同上传实现类。

- **责任链模式（可选扩展）**  
  允许在上传前后插入处理节点，如进度回调、限流、监控埋点。

---

### 🧰 实现要点

1. **UploadStrategy 接口**
   - 保留通用签名：
     ```java
     UploadResult upload(UploadRequest request);
     ```

2. **ThreeStepUploadStrategy 实现**
   - 持有 `TransportClient` 实例，通过依赖注入或工厂方式获取；
   - 调用 `AuthStep`、`CloudUploadStep`、`ReportStep`；
   - 以模板方法控制流程，确保顺序执行和异常处理。

3. **AuthStep**
   - 调用 SDK 授权接口（GetUploadAuthRequest → GetUploadAuthResponse）；
   - 解析上传URL、表单字段等。

4. **CloudUploadStep**
   - 根据授权信息将文件上传到云端；
   - 可调用 `OkHttpTransportClient`；
   - 后续支持流式上传、分片上传。

5. **ReportStep**
   - 上传成功后上报结果，调用服务器的回调接口；
   - 封装为通用可复用组件。

6. **UploadExecutor**
   - 封装上传全过程；
   - 可暴露执行日志、异常封装、Metrics 上报点。

---

### 🧾 输出要求

请生成：
1. 完整的包结构设计（含类名、职责描述）
2. 关键抽象类与接口定义（UploadStrategy、UploadExecutor、UploadStep）
3. `ThreeStepUploadStrategy` 的主要实现逻辑
4. 三步上传的流程图或伪代码框架
5. 提示未来如何扩展为流式上传、分片上传

要求：
- 遵循阿里Java编码规范
- 保持与现有 transport 模块命名、风格一致
- 所有类具备明确职责和注释
- 不写业务参数，只实现通用上传能力
````


