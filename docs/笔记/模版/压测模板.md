# 压测模板

## 一、基本信息

| 项目       | 内容                      |
|----------|-------------------------|
| **接口名称** | `/v3/xxx/yyy`           |
| **接口类型** | POST                    |
| **接口用途** | 接口功能描述                  |
| **被测系统** | 被测系统名称                  |
| **压测目的** | 说明压测目标，如：测试接口性能、并发处理能力等 |
| **环境**   | 线上环境 IP 或其他环境描述         |

## 二、接口描述

### 1. 接口地址

`http://example_ip:9000/v3/xxx/yyy`

### 2. 请求方式

POST /multipart/form-data（或其他请求方式）

### 3. 请求参数示例

| 参数名称       | 参数类型      | 是否必需 | 描述    |
|------------|-----------|------|-------|
| **param1** | `string`  | 是    | 参数1描述 |
| **param2** | `integer` | 否    | 参数2描述 |
| **param3** | `boolean` | 否    | 参数3描述 |

### 4. 响应示例

```json
{
  "code": 10000,
  "message": "操作成功",
  "data": {
    "key1": "value1",
    "key2": "value2"
  }
}
```

## 三、压测场景设计

### 1. 并发场景

| 场景名称    | 文件类型 | 文件大小  | 并发数 | 单批次文件数 | 总请求数  |
|---------|------|-------|-----|--------|-------|
| **场景1** | 类型A  | 500KB | 10  | 1000   | 10000 |
| **场景2** | 类型B  | 1MB   | 10  | 1000   | 10000 |
| **场景3** | 类型C  | 2MB   | 10  | 1000   | 10000 |
| **场景4** | 类型D  | 3MB   | 10  | 1000   | 10000 |

### 2. 场景解释

* **场景1**: 场景说明，如：上传 500KB 大小的文件，使用 10 并发，测试总文件数 10000。
* **场景2**: 场景说明，如：上传 1MB 大小的文件，使用 10 并发，测试总文件数 10000。

## 四、压测工具与脚本

### 1. 使用工具

* **工具**: 如：Shell 脚本 + curl / JMeter / Gatling 等

### 2. 脚本示例

```bash
#!/bin/bash

# 上传函数
upload_file() {
    local file=$1
    local type=$2
    local extension=$3
    local url="http://example_ip:9000/v3/xxx/yyy"

    curl --location --request POST "$url" \
    --form "file=@$file" \
    --header "type: $type" \
    --header "extension: $extension" \
    --header "directoryName: your_directory"
}

# 并发上传指定文件
for i in {1..1000}; do
    upload_file "/path/to/fileA" "typeA" "extA" &   # 类型A文件
    upload_file "/path/to/fileB" "typeB" "extB" &   # 类型B文件
done

wait
```

## 五、监控项

| 监控项             | 描述                               |
|-----------------|----------------------------------|
| **QPS**         | 每秒请求数                            |
| **响应时间**        | - 平均响应时间 / 99分位响应时间 / 99.9分位响应时间 |
| **错误率**         | HTTP 非 2xx 请求比例                  |
| **上传成功率**       | 文件上传成功数量 / 总请求数量                 |
| **服务器 CPU 使用率** | 观察是否达到瓶颈                         |
| **内存 / IO 使用率** | 是否出现内存溢出、磁盘写入过慢                  |

### 监控工具

* **Prometheus + Grafana**：用于采集和展示系统性能指标。
* **JMeter / Gatling**：用于并发压力测试，模拟大规模请求并获取性能数据。

## 六、压测结果记录

| 场景名称    | 总请求数  | 成功数   | 上传成功率 | 平均响应时间 | 99分位响应 | 99.9分位响应 | 并发数 | 服务器 CPU 使用率 |
|---------|-------|-------|-------|--------|--------|----------|-----|-------------|
| **场景1** | 10000 | 10000 | 100%  | 800ms  | 1150ms | 1500ms   | 10  | 6%          |
| **场景2** | 10000 | 10000 | 100%  | 900ms  | 1200ms | 1600ms   | 10  | 8%          |
| **场景3** | 10000 | 10000 | 100%  | 1300ms | 1800ms | 2200ms   | 10  | 12%         |
| **场景4** | 10000 | 10000 | 100%  | 1100ms | 1500ms | 1900ms   | 10  | 10%         |

## 七、结论与建议

* **性能评估**：不同场景下的上传成功率为 100%，响应时间随着请求量和文件大小的增加有所变化，始终保持在可接受范围内。
* **服务器负载**：随着并发数的增加，服务器的 CPU 和内存使用率逐渐上升。建议通过优化文件处理流程、增加服务器资源等手段来降低负载。
* **优化建议**：

    1. 对大文件上传可以考虑引入分块上传机制。
    2. 在高并发场景下，加入限流机制以防止系统过载。
    3. 针对大文件类型，考虑优化文件压缩处理，提高上传效率。
